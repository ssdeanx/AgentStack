---
title: "Workflows API"
description: "Reference for Workflows endpoints — creating, starting, streaming, managing and observing workflow runs in AgentStack (Mastra)."
date: "2025-12-01"
readTime: "8 min read"
category: "API"
slug: "workflows"
---

import { ApiEndpoint, ApiParam, CodeBlock } from "@/app/components/api-components"

# Workflows API

Workflows in AgentStack compose multiple steps and agents to execute multi-step, long-running processes with clear state and observability. This page documents the primary workflow endpoints you'll interact with: listing workflows, creating runs, starting runs, streaming outputs, observing results, resuming paused runs, and cancelling runs.

---

## Common patterns

- Workflows typically follow pattern: create-run → start → stream and observe → complete/cancel.
- `create-run` often returns a run identifier `runId`.
- `start-async` runs a workflow asynchronously (no direct stream).
- `stream` endpoints provide SSE or chunked responses for progressive updates.
- `observe` endpoints allow status checks and retrieval of step-by-step execution details.

> Security note: All workflow endpoints should be authenticated & authorized to prevent misuse. Use `Authorization` header or other middleware.

---

## Workflow endpoints overview

<ApiEndpoint method="GET" path="/api/workflows" description="List all available workflows" />

<ApiEndpoint method="GET" path="/api/workflows/{workflowId}" description="Get workflow details" />
- Params:
  - `workflowId`: ID of the workflow to fetch.

<ApiEndpoint method="GET" path="/api/workflows/{workflowId}/runs" description="List runs for a workflow" />
- Query:
  - `page` / `perPage` for pagination.

<ApiEndpoint method="GET" path="/api/workflows/{workflowId}/runs/{runId}" description="Get run details" />
- Params:
  - `workflowId`
  - `runId` — the unique identifier for a run.

---

## Creating and Starting Runs

<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/create-run" description="Create a new run for a workflow (returns runId)" >
  <ApiParam name="workflowId" type="string" required description="ID of the workflow" />
  <ApiParam name="input" type="object" required description="Workflow input object (conforms to workflow input schema)" />
</ApiEndpoint>

Example: create a run via cURL:
<CodeBlock title="Create a run: cURL example" language="bash">
{`curl -X POST "http://localhost:4111/api/workflows/content-studio-workflow/create-run" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $API_KEY" \
  -d '{
    "inputData": {
      "topic": "Hello World with AgentStack",
      "tone": "friendly",
      "audience": "developers"
    }
  }'`}
</CodeBlock>

Once you have a `runId`, you can start the run:

<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/start" description="Start a created workflow run (synchronous or blocking)" />
<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/start-async" description="Start a workflow run asynchronously (non-blocking)" />

Example: Start a run with a `runId`:
<CodeBlock title="Start a run: cURL example" language="bash">
{`curl -X POST "http://localhost:4111/api/workflows/content-studio-workflow/start" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $API_KEY" \
  -d '{"runId": "run-12345", "runtimeContext": { "userId": "123" } }'`}
</CodeBlock>

---

## Streaming & Observing Run Execution

You can stream step-by-step output for user feedback and progressive updates.

<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/stream" description="Stream workflow steps & updates (SSE/streaming)"/>
<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/observe" description="Observe run state via structured snapshots"/>
<ApiEndpoint method="GET" path="/api/workflows/{workflowId}/watch" description="Open a watch/stream for run updates (SSE)"/>

Streaming Example:
<CodeBlock title="Stream a run via the streaming endpoint" language="bash">
{`curl -s -N -X POST "http://localhost:4111/api/workflows/content-studio-workflow/stream" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $API_KEY" \
  -d '{ "runId": "run-12345", "runtimeContext": { "userId": "123" } }'`}
</CodeBlock>

> Note: If your frontend uses the streaming API, it should expect partial events or UIMessage parts that can be treated as incremental responses.

---

## Resuming & Cancelling

A workflow run can be paused or suspended; resume endpoints allow continuing a suspended run. Use `cancel` to stop a running work in emergencies or to abort.

<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/resume" description="Resume a previously paused run" />
<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/resume-async" description="Resume a run asynchronously" />

<ApiEndpoint method="POST" path="/api/workflows/{workflowId}/runs/{runId}/cancel" description="Cancel a run" />
- Params:
  - `workflowId`, `runId`
- Body:
  - Optional: a reason string for why the run was canceled.

Example: Cancel a run:
<CodeBlock title="Cancel a run: cURL example" language="bash">
{`curl -X POST "http://localhost:4111/api/workflows/content-studio-workflow/runs/run-12345/cancel" \
  -H "Authorization: Bearer $API_KEY" \
  -H "Content-Type: application/json" \
  -d '{ "reason": "User requested cancel" }'`}
</CodeBlock>

---

## Additional endpoints & Observability

Workflow endpoints often include:

- `GET /api/workflows/{workflowId}/runs/{runId}/execution-result` — fetch final execution results or outputs.
- `POST /api/workflows/{workflowId}/resume-stream-legacy` — legacy or compatibility streaming endpoints.
- `POST /api/workflows/{workflowId}/observe-streamVNext` — alternative streaming interface for vNext clients.

These are useful for debugging, CI integration, or export of execution traces.

---

## Example Run Lifecycle

1. `POST /create-run` (returns runId)
2. `POST /start-async` (returns immediate success)
3. `POST /stream` or `GET /watch` to observe updates
4. `GET /runs/{runId}` to fetch completed run state
5. If necessary, `POST /cancel` to stop the run

---

## Advice for Using Workflows

- Validate the `inputData` according to the workflow’s input schema before creating a run.
- Use `runtimeContext` to provide boundaries & user context (e.g., `userId`, `tenantId`, `tier`) to manage RBAC and telemetry.
- For long-running or stateful workflows, use `observe` and `watch` endpoints for frontends instead of polling.
- Provide `maxSteps` and resource limits to avoid runaway runs or cost spikes.
- Handle run `status` and `errors` per run; persist events to logs and observability for future debugging.

---

## Example: Create & observe a run with JS (node)
<CodeBlock title="Create & observe a run (JS)" language="js">
{`// Create
const createRes = await fetch("http://localhost:4111/api/workflows/content-studio-workflow/create-run", {
  method: "POST",
  headers: { "Authorization": \`Bearer ${API_KEY}\`, "Content-Type": "application/json" },
  body: JSON.stringify({ inputData: { topic: "New blog post idea" } })
});
const createBody = await createRes.json();
const runId = createBody.runId;

// Stream updates
const streamRes = await fetch("http://localhost:4111/api/workflows/content-studio-workflow/stream", {
  method: "POST",
  headers: { "Authorization": \`Bearer ${API_KEY}\`, "Content-Type": "application/json" },
  body: JSON.stringify({ runId })
});

// Handle streaming events (SSE or chunked JSON)
streamRes.body.on('data', (chunk) => { console.log('event:', chunk.toString()) });
`}
</CodeBlock>

---

## Best practices & Security

- Restrict who can create or start workflows in ACLs — many workflows may call tools that can change state or perform writes.
- Enforce `maxSteps` and step-level timeouts.
- Ensure that `runtimeContext` and `inputData` are authenticated and authorized.
- Validate input using typed schema (e.g., zod) to ensure your workflow handler won't crash on unexpected shapes.
- Keep an audit of runs, steps, and tool calls for observability and post-mortem debugging.

---

## Where to find workflows in the repo

- `src/mastra/workflows` — workflow definitions (e.g., `content-review-workflow.ts`, `financial-report-workflow.ts`).
- `src/mastra/index.ts` — where workflows are registered with the Mastra instance and server routes are configured.
- `src/mastra/mcp` — the MCP server exposes workflows metadata when needed.

---

If you'd like, I can:

- Add detailed schema examples for each workflow (input & output JSON shapes).
- Add step-by-step examples for a specific workflow in the repo (like `content-studio-workflow`).
- Add codegen for SDK clients to call these endpoints directly (JS/TS) with typed inputs and outputs.
